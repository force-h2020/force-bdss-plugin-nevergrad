Introduction
------------

.. contents:: Table of contents


******************************
The ``force-nevergrad`` plugin
******************************

The `force-bdss-plugin-nevergrad  <https://github.com/force-h2020/force-bdss-plugin-nevergrad>`_ contributes a wrapper
around the gradient-free optimization library `nevergrad <https://github.com/facebookresearch/nevergrad>`_.
The wrapper consists of two parts:

#. The optimization engine ``NevergradOptimizerEngine``, which is used as a backend tool
   for worklow optimization.
   The engine inherits from the ``BaseOptimizerEngine`` class.
   It provides a public ``optimize()`` method that  yields workflow input data and output results, and any additional
   metadata generated by the engine.
#. The basic multi-criteria optimizer ``NevergradMCO(BaseMCO)``. The ``MCO`` class configures the ``NevergradOptimizerEngine``
   instance, and executes the optimizer.
   The standard progress events ``MCOProgressEvent`` are generated during the optimization, containing the optimal points and
   optimal KPIs.

Users can perform the gradient-free optimization of their workflows by specifying the ``nevergrad_mco`` as the MCO model id:

.. code-block:: json

    "workflow": {
        "mco_model": {
            "id": "force.bdss.nevergrad.plugin.wrapper.v0.factory.nevergrad_mco",
            "model_data": {
                "algorithms": "OnePlusOne",
                "budget": 200,
                "verbose_run": true
            }
        }
    }


Users can import the ``NevergradOptimizerEngine`` and implement their own family of ``MCOFactory, MCOModel, MCO`` classes
that use the ``nevergrad`` as the optimizer engine.


Nevergrad optimizer engine
################################


The ``NevergradOptimizerEngine`` inherits from the ``BaseOptimizerEngine``, and requires a list of MCO parameters and KPIs
to be specified upon the engine instantiation.
The ``NevergradOptimizerEngine`` parses the standard ``force-bdss`` MCO parameters into its own internal types.
The ``NevergradOptimizerEngine`` can handle

* continuous numerical parameters (these implement ``lower_bound`` and ``upper_bound`` attributes),
* ordered discrete parameters (these implement ``levels`` attribute),
* unordered discrete parameters (these implement ``categories`` attribute), and
* constant-valued paramaters (these implement ``value`` attribute).

The KPIs are implicitly assumed to be minimized over the course of optimization.
User should provide the upper bounds for the KPIs, which is required by the multiobjective optimization algorithm,
implemented in ``nevergrad``.
Due to the backwards compatibility issues, the KPIs' upper bounds must be specified by the ``scale_factor`` field.
(This will likely be fixed in the next release, see `this issue <https://github.com/force-h2020/force-bdss/issues/293>`_).
